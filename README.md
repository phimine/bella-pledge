### 系统概述

一个去中心化金融（DeFi）项目，旨在提供固定利率的借贷协议，主要服务于加密资产持有者。 旨在解决 DeFi 借贷市场中缺乏固定利率和固定期限融资产品的问题。传统的 DeFi 借贷协议通常采用可变利率，主要服务于短期交易者，而该协议则专注于长期融资需求。

### 核心功能

1. **固定利率借贷** 提供固定利率的借贷服务，减少利率波动带来的风险。
2. **去中心化 Dex 交易**
3. **跨链支持**：Pledge 协议支持多条公链上的借贷和衍生品交易。（可选）
4. **金融 NFT**：：利用金融 NFT 技术，Pledge 提供包括保险、债券等在内的多种金融产品。（可选）
5. **多资产支持**：支持多种加密资产和非加密资产（如房地产）的抵押。

### 主要角色

1. **借款人**：可以抵押加密资产以获得稳定币，用于投资非加密资产。
2. **贷款人**：提供流动性，获得固定回报。
3. **流动性提供者**：将稳定币锁定在流动性池中，提供流动性支持。

### 借贷池合约

PledgePool.sol 是 Pledge 项目的核心智能合约之一，主要功能包括：

1. **创建和管理借贷池**：包括设置借贷池的基本信息、状态管理等。
2. **用户存款和取款**：处理用户的借款和贷款操作，包括存款、取款、索赔等。
3. **自动清算**：根据设定的阈值自动触发清算操作，保护借贷双方的利益。
4. **费用管理**：设置和管理借贷费用，确保平台的可持续运营。

### 借贷池状态流转

MATCH --> UNDONE
|
EXECUTION --> FINISH
|
LIQUIDATION

MATCH: 支持借款人抵押借款、贷款人抵押提供流动性
MATCH --> UNDONE: 到达settleTime，但lend或borrow金额为0，取消借贷
UNDONE: 支持借款人赎回抵押、贷款人提现抵押
MATCH --> EXECUTION: 到达settleTime, 借贷协议开始生效
EXECUTION: 支持借款人索赔、贷款人索赔、借款人还款
EXECUTION --> FINISH: 到达endTime，结算借贷
FINISH：支持借款人赎回剩余抵押、索赔，贷款人提现、索赔
EXECUTION --> LIQUIDATION: 到达清算条件，清算借贷
LIQUIDATION: 支持借款人赎回剩余抵押、索赔，贷款人提现、索赔

### 数据结构

```
借贷池 {
    结算时间，
    结束时间，
    总供应量，
    借贷供应量，
    抵押供应量，
    借贷资产代币，
    抵押资产代币，
    抵押率，
    利率，
    存款代币spToken，
    债务代币jpToken，
    自动清算阈值，
    借贷池状态（MATCH/EXECUTION/FINISH/LIQUIDATION/UNDONE）
}

借贷池数据 {
    结算借贷总量，
    结算抵押总量，
    结束借贷总量，
    结束抵押总量，
    清算借贷总量，
    清算抵押总量，
}

用户借贷信息 {
    借贷质押总量，
    借贷退款总量，
    是否退款，
    是否索赔
}

用户抵押信息 {
    抵押总量，
    退还抵押量，
    是否退还，
    是否索赔
}

借贷池状态 {
    MATCH，
    EXECUTION,
    FINISH,
    LIQUIDATION,
    UNDONE
}
```

### 状态变量

借贷费
抵押费
手续费地址
最小质押
交换路由地址

借贷池列表
借贷池数据列表

用户借贷列表：user address => pool id => LeadInfo
用户抵押列表：user address => pool id => borrowInfo

预言机
暂停状态

### 角色&事件

1. **管理员**：设置借贷费率、设置借贷费接收地址、设置交换路由、设置最小质押、全局暂停功能、
   新增借贷池、结算借贷、清算借贷
2. **贷款人**：抵押Deposit、退款Refund、索赔Claim、提现Withdraw
3. **借贷人**：抵押Deposit、退款Refund、索赔Claim、提现Withdraw

### 模块划分

1. **借贷代币**：ERC20协议，用于存款代币、债务代币
2. **多签功能**：支持多签
3. **安全转账**：安全转账函数
4. **价格预言机**：通过Chainlink获取代币价格
5. **借贷合约**：核心合约，主功能，借贷池交易平台（TBD，业务场景待定）
